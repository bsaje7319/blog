.. contents::
   :depth: 3
..

业务服务监控详解
================

文件内容差异对比方法
--------------------

示例1：两个字符串的差异对比
~~~~~~~~~~~~~~~~~~~~~~~~~~~

::

    #!/usr/bin/env python
    # -*- coding: utf-8 -*-
    # @auther:   18793
    # @Date：    2020/10/29 15:08
    # @filename: 2.1.py
    # @Email:    1879324764@qq.com
    # @Software: PyCharm
    import difflib

    text1 = """text1:
    This module provides classes and functions for comparing sequences.
    including HTML and context and unified diffs.
    difflib document v7.4
    add string"""

    text1 = text1.splitlines()  # 以行进行分割

    text2 = """text2:
    This module provides classes and functions for Comparing sequences.
    including HTML and context and unified diffs.
    difflib document v7.5"""
    text2 = text2.splitlines()
    d = difflib.Differ()
    diff = d.compare(text1, text2)
    print("\n".join(list(diff)))

本示例采用Differ()类对两个字符串进行比较，
另外difflib的SequenceMatcher()类支持任意类型序列的比较，
HtmlDiff()类支持将比较结果输出为HTML格式，

**生成美观的对比HTML格式文档**

::

    #!/usr/bin/env python
    # -*- coding: utf-8 -*-
    # @auther:   18793
    # @Date：    2020/10/29 15:08
    # @filename: 2.1.py
    # @Email:    1879324764@qq.com
    # @Software: PyCharm
    import difflib

    text1 = """text1:
    This module provides classes and functions for comparing sequences.
    including HTML and context and unified diffs.
    difflib document v7.4
    add string"""

    text1 = text1.splitlines()  # 以行进行分割

    text2 = """text2:
    This module provides classes and functions for Comparing sequences.
    including HTML and context and unified diffs.
    difflib document v7.5"""
    text2 = text2.splitlines()
    # d = difflib.Differ()
    # diff = d.compare(text1, text2)
    # print("\n".join(list(diff)))
    d = difflib.HtmlDiff()

    # 创建index.html文件并写入内容
    html = d.make_file(text1, text2)
    with open("index.html", "w", encoding="utf-8") as f:
        f.write(html)

示例2：对比Nginx配置文件差异
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

::

    #!/usr/bin/env python
    # -*- coding: utf-8 -*-
    # @auther:   18793
    # @Date：    2020/10/29 15:23
    # @filename: 2.2.py
    # @Email:    1879324764@qq.com
    # @Software: PyCharm
    import difflib
    import sys

    try:
        textfile1 = sys.argv[1]
        textfile2 = sys.argv[2]

    except Exception as e:
        print("Error:" + str(e))
        print("Usage: simple.py filename1 filename2")
        sys.exit()


    def readfile(filename):
        try:
            fileHandle = open(filename, "r", encoding="utf-8")
            text = fileHandle.read().splitlines()  # 读取后进行分割
            fileHandle.close()
            return text
        except Exception as e:
            print("Read file error:", str(e))
            sys.exit()


    if textfile1 == "" or textfile2 == "":
        print("Usage: simple.py filename1 filename2")
        sys.exit()

    # 获取分割后的字符串
    text1_lines = readfile(textfile1)
    text2_lines = readfile(textfile2)

    d = difflib.HtmlDiff()
    html = d.make_file(text1_lines, text2_lines)

    with open("index2.html", "w", encoding="utf-8") as f:
        f.write(html)
